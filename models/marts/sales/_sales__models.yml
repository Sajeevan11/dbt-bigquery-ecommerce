version: 2

models:
  - name: mart_customer_orders
    description: |
      Customer-level order metrics aggregated from staging orders.
      Includes order counts by status, completion rates, and behavioral segmentation.
    columns:
      - name: user_id
        description: "Unique customer identifier"
        tests:
          - unique
          - not_null
      
      - name: total_orders
        description: "Total number of orders placed by customer"
        tests:
          - not_null
      
      - name: completion_rate
        description: "Percentage of orders completed (0-100)"
        tests:
          - not_null
      
      - name: cancellation_rate
        description: "Percentage of orders cancelled (0-100)"
      
      - name: return_rate
        description: "Percentage of orders returned (0-100)"
      
      - name: first_order_date
        description: "Date of customer's first order"
        tests:
          - not_null
      
      - name: customer_behavior
        description: "Customer behavior classification"
        tests:
          - accepted_values:
              values: ['Mostly Complete', 'High Cancellation', 'High Returns', 'Mixed']
              
  - name: mart_user_behavior
    description: |
      Product performance analysis aggregating order metrics by product.
      **Business purpose:**
      Enables product managers to identify top/underperforming products,
      analyze completion rates, and make data-driven inventory decisions.
      
      **Methodology:**
      - LEFT JOIN from products to preserve all products (even those never ordered)
      - Aggregates order_items to count total orders per product
      - Filters completed orders using order status
      
      **Metrics included:**
      - total_orders: Count of all orders (0 for products never ordered)
      - completed_orders: Count of successfully completed orders
      - avg_price: Average retail price of the product
      
      **Known limitations:**
      - Products with NULL names show as 'Unknown Product' (2 products)
      - Products with NULL brands show as 'Unknown Brand' (24 products)
      
      **Grain:** One row per product
    columns:
      - name: user_id
        description: "Unique user identifier"
        tests:
          - unique
          - not_null
      
      - name: user_email
        description: "User's email address"
        tests:
          - not_null
      
      - name: user_age
        description: "User's age"
        tests:
          - not_null
      
      - name: age_group
        description: "Age segmentation for marketing analysis"
        tests:
          - accepted_values:
              values: ['Young (< 25)', 'Adult (25-34)', 'Middle Age (35-49)', 'Senior (50-64)', 'Elder (65+)']
      
      - name: user_classification
        description: "User activity classification based on order count"
        tests:
          - not_null
          - accepted_values:
              values: ['Never Ordered', 'One-Time Buyer', 'Occasional Buyer', 'Frequent Buyer']
      
      - name: total_orders
        description: "Total number of orders (0 for users who never ordered)"
        tests:
          - not_null
      
      - name: completion_rate
        description: "Percentage of completed orders (0-100)"

  - name : mart_product_performance
    description: |
      Product performance metrics with order statistics
    columns:
      - name: product_id
        description: "Unique product identifier"
        tests:
          - unique
          - not_null

      - name: product_name
        description: "Product name"
        tests:
          - not_null
      
      - name: total_orders
        description: "Total number of orders for this product"
        tests:
          - not_null
      
      - name: completed_orders
        description: "Number of completed orders"
        tests:
          - not_null